---
import Link from '@/components/Link.astro'
import { NAV_LINKS } from '@/consts'

const currentPath = Astro.url.pathname
const searchParams = Astro.url.search // '?page=1' 같은 쿼리 문자열

// /blog 또는 /blog/ 만 허용
const isBlogRoot = currentPath === '/blog' || currentPath === '/blog/'

// /blog 하위 경로나 쿼리일 경우
const isBlogSubPath =
  (currentPath.startsWith('/blog/') && !isBlogRoot) ||
  (currentPath === '/blog' && searchParams !== '')
---

<div>
  <div class="mx-auto mt-2 max-w-3xl space-y-2 px-4 py-3">
    <Link href="/" class="flex items-baseline gap-x-2">
      <h3 class="text-xl font-medium">Donghak Kim</h3>
      <p class="text-muted-foreground text-sm">
        Software &bull; Cloud Engineer
      </p>
    </Link>

    <div class="mt-4 grid grid-flow-row border text-sm sm:grid-flow-col">
      {
        isBlogSubPath ? (
          // ✅ /blog 하위 경로일 경우: "돌아가기"만 표시
          <Link
            href="/blog"
            class="py-2 text-center text-blue-600 capitalize transition-colors hover:underline"
          >
            ← 돌아가기
          </Link>
        ) : (
          // ✅ 기본 메뉴 표시
          NAV_LINKS.map((item) => {
            const isActive =
              item.href === currentPath ||
              (item.href !== '/' && currentPath.startsWith(item.href))

            return (
              <Link
                href={item.href}
                class={`py-2 text-center capitalize transition-colors ${
                  isActive
                    ? 'text-foreground bg-neutral-100 font-medium'
                    : 'text-foreground/60 hover:text-foreground'
                }`}
              >
                {item.label}
              </Link>
            )
          })
        )
      }
    </div>
  </div>
</div>
